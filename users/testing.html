

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 Generated by Apache Maven Doxia
 Rendered using Reflow Maven Skin 1.5.0 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
          
        <head>
    <meta charset="UTF-8" />
    <title>Apache PLC4XÂ® - Testing (or using PLC4X without a PLC)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
      <meta http-equiv="content-language" content="en" />
                                                                <link href="../css/bootstrap.min.css" rel="stylesheet" />
                <link href="../css/docs.css" rel="stylesheet" />
    <link href="../css/reflow-skin.css" rel="stylesheet" />

    <link rel="stylesheet" href="../js/styles/default.min.css" />

    <link href="../css/lightbox.css" rel="stylesheet" />
    <link href="../css/site.css" rel="stylesheet" />
    <link href="../css/print.css" rel="stylesheet" media="print" />
<script>
          document.addEventListener("DOMContentLoaded", function(event) {
            /* Add an image for promoting Apache events below the right banner */
            $("#bannerRight").append('<p id="apacheEvents"><a href="//www.apache.org/events/current-event.html"><img src="//www.apache.org/events/current-event-234x60.png"/></a></p>');
            /* Append the trademarks info to the copyright section */
            $(".copyright").append('<p>Apache PLC4X, PLC4X, Apache, the Apache feather logo, and the Apache PLC4X project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</p>');
          });
        </script>
        </head> <!-- end : head -->
    <body class="page-users-testing project-plc4x-parent">

    <div id="m-top-navbar" class="navbar  navbar-default navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#top-navbar-collapse-1" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                        <a class="navbar-brand" href="..">Apache PLC4X</a>
        </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown active">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="download.html"  title="Download" >Download</a></li>
                    <li ><a  href="gettingstarted.html"  title="Getting Started" >Getting Started</a></li>
                                    <li  class="active" ><a  href=""  title="PLC4X without a PLC and Unit Testing" >PLC4X without a PLC and Unit Testing</a></li>
                    <li ><a  href="opm.html"  title="Object PLC Mapping (OPM)" >Object PLC Mapping (OPM)</a></li>
                    <li ><a  href="industry40.html"  title="Industry 4.0 with Apache" >Industry 4.0 with Apache</a></li>
                    <li ><a  href="security.html"  title="Security" >Security</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../developers/issues.html"  title="Bug & Issue Tracker" >Bug & Issue Tracker</a></li>
                    <li ><a  href="../developers/building.html"  title="Building PLC4X" >Building PLC4X</a></li>
                    <li ><a  href="../developers/sonar.html"  title="Code Analysis" >Code Analysis</a></li>
                    <li class="dropdown-submenu ">
<a  href="../developers/code-gen/index.html"  title="Code Generation" >Code Generation</a>                    <ul class="dropdown-menu">
                        <li ><a  href="../developers/code-gen/protocol/mspec.html"  title="Protocol: MSpec Format" >Protocol: MSpec Format</a></li>
                        <li ><a  href="../developers/code-gen/language/freemarker.html"  title="Language: Apache Freemarker" >Language: Apache Freemarker</a></li>
                        <li ><a  href="../developers/code-gen/protocol/df1.html"  title="Example: DF1 MSpec" >Example: DF1 MSpec</a></li>
                    </ul>
                </li>
                    <li ><a  href="../developers/ci.html"  title="Continuous Integration" >Continuous Integration</a></li>
                    <li ><a  href="../developers/contributing.html"  title="Contributing" >Contributing</a></li>
                    <li ><a  href="../developers/decisions.html"  title="Decision Making" >Decision Making</a></li>
                    <li ><a  href="../developers/maturity.html"  title="Maturity" >Maturity</a></li>
                    <li ><a  href="../developers/preparing.html"  title="Preparing your Computer" >Preparing your Computer</a></li>
                    <li ><a  href="../developers/release.html"  title="Releasing" >Releasing</a></li>
                    <li ><a  href="../developers/release-build-tools.html"  title="Releasing Build-Tools" >Releasing Build-Tools</a></li>
                    <li ><a  href="../developers/team.html"  title="Team" >Team</a></li>
                    <li ><a  href="../developers/vm.html"  title="VM Access" >VM Access</a></li>
                    <li ><a  href="../developers/vpn.html"  title="VPN Access" >VPN Access</a></li>
                    <li ><a  href="../developers/website.html"  title="Website" >Website</a></li>
                    <li ><a  href="../developers/wiki.html"  title="Wiki" >Wiki</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Protocols <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../protocols/ab-eth/index.html"  title="AB-Ethernet" >AB-Ethernet</a></li>
                    <li ><a  href="../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../protocols/s7/index.html"  title="S7" >S7</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reports <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li class="dropdown-submenu ">
<a  href="../project-info.html"  title="Project Information" >Project Information</a>                    <ul class="dropdown-menu">
                        <li ><a  href="../dependency-convergence.html"  title="Dependency Convergence" >Dependency Convergence</a></li>
                        <li ><a  href="../dependency-info.html"  title="Dependency Information" >Dependency Information</a></li>
                        <li ><a  href="../dependency-management.html"  title="Dependency Management" >Dependency Management</a></li>
                        <li ><a  href="../distribution-management.html"  title="Distribution Management" >Distribution Management</a></li>
                        <li ><a  href="../index.html"  title="About" >About</a></li>
                        <li ><a  href="../issue-management.html"  title="Issue Management" >Issue Management</a></li>
                        <li ><a  href="../licenses.html"  title="Licenses" >Licenses</a></li>
                        <li ><a  href="../mailing-lists.html"  title="Mailing Lists" >Mailing Lists</a></li>
                        <li ><a  href="../modules.html"  title="Project Modules" >Project Modules</a></li>
                        <li ><a  href="../plugin-management.html"  title="Plugin Management" >Plugin Management</a></li>
                        <li ><a  href="../plugins.html"  title="Plugins" >Plugins</a></li>
                        <li ><a  href="../scm.html"  title="Source Code Management" >Source Code Management</a></li>
                        <li ><a  href="../summary.html"  title="Summary" >Summary</a></li>
                    </ul>
                </li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Apache <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
            </ul>
        </li>
            </ul>
        </div><!--/.nav-collapse -->
      </div> <!--/.container -->
    </div> <!--/.navbar -->
  <div class="container">
  <!-- Masthead -->
  <!-- ================================================== -->  <div class="header container-fluid">
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="col-md-12">
        <div class="pull-left">
                                      <a href="https://plc4x.apache.org/" id="bannerLeft">
                    <img src="https://plc4x.apache.org/images/apache_plc4x_logo.png"
                 alt='"'Apache PLC4X'"'
 />            </a>
                    <p class="lead">The industrial IoT adapter</p>
        </div>
        <div class="pull-right">
                                      <a href="https://www.apache.org/" id="bannerRight">
                    <img src="https://plc4x.apache.org/images/apache_logo.png"
                 alt='"'Apache Software Foundation'"'
 />            </a>
        </div>
      </div>
    </div>
  </div>
    <hr class="toc-separator" />
    <div id="toc-bar" class="navbar navbar-default">
      <div id="toc-scroll-target" class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#toc-nav-collapse" aria-expanded="false">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
            </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="toc-nav-collapse">
          <ul id="toc" class="nav navbar-nav">
                                                            <li class="toplevel"><a href="#_toc_testing_or_using_plc4x_without_a_plc1" title="Testing (or using PLC4X without a PLC)">Testing (or using PLC4X without a PLC)</a></li>
                        <li class="toplevel"><a href="#_toc_the_mock_driver1" title="The Mock Driver">The Mock Driver</a></li>
                        <li class="toplevel"><a href="#_toc_simple_example1" title="Simple Example">Simple Example</a></li>
                        <li class="toplevel"><a href="#_toc_unit_testing_with_the_mock_driver1" title="Unit Testing with the Mock Driver">Unit Testing with the Mock Driver</a></li>
                        <li class="toplevel"><a href="#_toc_conclusion1" title="Conclusion">Conclusion</a></li>
          </ul>
        </div>
      </div> <!-- .container -->
    </div> <!-- end: toc-bar -->
  </div> <!-- end : header -->
  <div class="main-body">

  <div class="row">
    <div class="col-md-12">
      <div class="body-content">
<div class="sect1"> 
 <div class="page-header">
  <h2 id="_toc_testing_or_using_plc4x_without_a_plc1">Testing (or using PLC4X without a PLC)</h2>
 </div> 
 <div class="sectionbody"> 
  <div class="sect2"> 
   <h3 id="_toc_the_mock_driver1">The Mock Driver</h3> 
   <div class="paragraph"> 
    <p>PLC4X has a <em>Mock Driver</em> which was initially implemented to be used for Unit Tests and this still is its main purpose. But this driver is also very suitable to play around a bit with the PLC4X API if no <em>Hardware</em> PLC is available. The driver can be found in the Maven module</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.plc4x&lt;/groupId&gt;
  &lt;artifactId&gt;plc4j-transport-test&lt;/artifactId&gt;
  &lt;version&gt;${current.version}&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>The connection string Syntax for the mock driver is <code>mock:{name-of-the-connection}</code>. So you can use multiple Mock Devices at the same time.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The Mock Driver does nothing else than forwarding all Requests to a <em>Virtual Device</em> which we can provide to control all responses and also Monitor them, e.g. for unit tests. The Interface for the Mock Device is</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>public interface MockDevice {

    Pair&lt;PlcResponseCode, PlcValue&gt; read(String fieldQuery);

    PlcResponseCode write(String fieldQuery, Object value);

    Pair&lt;PlcResponseCode, PlcSubscriptionHandle&gt; subscribe(String fieldQuery);

    void unsubscribe();

    // ...

}</code></pre> 
    </div> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_simple_example1">Simple Example</h3> 
   <div class="paragraph"> 
    <p>Imagine we have some Code which we cannot control or whose functionality we want to test. This can be done with the Mock Driver in the following way.</p> 
   </div> 
   <div class="paragraph"> 
    <p>First, a new Mock Connection is established (like any other connection also would be):</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>PlcDriverManager driverManager = new PlcDriverManager();
PlcMockConnection connection = (PlcMockConnection) driverManager.getConnection("mock:my-mock-connection");</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>You see, that we directly cast the Connection to a <code>PlcMockConnection</code>. This is done, because we need to <em>connect</em> a Device to this Mock Connection.</p> 
   </div> 
   <div class="paragraph"> 
    <p>This is done in the following Snippet</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>connection.setDevice(mockDevice);</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>Here, we pass it an instance of <code>MockDevice</code> which could be a simple Implementation of the interface like</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>MockDevice mockDevice = new MockDevice() {

    Pair&lt;PlcResponseCode, PlcValue&gt; read(String fieldQuery) {
        System.out.println("I got a read to " + fieldQuery);
        return Pair.of(PlcResponseCode.OK, new PlcString("hello"));
    }

    PlcResponseCode write(String fieldQuery, Object value) {
        System.out.println("I got a write to " + fieldQuery + " with the value " + value);
        return PlcResponseCode.OK;
    }

    // ...

}</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>This would just return a String Value <code>hello</code> for every request and print all read and write requests to the Console.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_unit_testing_with_the_mock_driver1">Unit Testing with the Mock Driver</h3> 
   <div class="paragraph"> 
    <p>To use the Mock driver in Unit Tests the easiest way is to generate the <code>MockDriver</code> instance as Mockito (or any other Framework) Mock. Like in the following Example</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>MockDevice mockDevice = Mockito.mock(MockDevice.class);

PlcDriverManager driverManager = new PlcDriverManager();
PlcMockConnection connection = (PlcMockConnection) driverManager.getConnection("mock:my-mock-connection");
connection.setDevice(mockDevice);

// Populate the Mock to avoid a NPE
when(mockDevice).read(anyString()).thenReturn(Pair.of(PlcResponseCode.OK, new PlcString("hello")));

// Some Demo code that uses the same Driver Manager and either the connection from above
// or at least mock:my-mock-connection as connection string
// Here: send a request to the field "MyAdress"
connection
    .readRequestBuilder
    .addItem("station", "MyAdress")
    .build()
    .execute()
    .get();

// Check that the we really issued a Read request to the Field "MyAdress"
verify(mockDevice).read(eq("MyAdress"));</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>But as the <em>MockDriver</em> uses a static Mock Connection registry the following Code works also</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="prettyprint highlight"><code>MockDevice mockDevice = Mockito.mock(MockDevice.class);

// Setup
PlcDriverManager driverManager = new PlcDriverManager();
PlcMockConnection connection = (PlcMockConnection) driverManager.getConnection("mock:my-mock-connection");
connection.setDevice(mockDevice);
// Populate the Mock to avoid a NPE
when(mockDevice).read(anyString()).thenReturn(Pair.of(PlcResponseCode.OK, new PlcString("hello")));

// Some Demo code that uses the same Driver Manager and either the connection from above
// or at least mock:my-mock-connection as connection string
// Here: send a request to the field "MyAdress"
// and we build up a new Connection
try (PlcConnection conn = driverManager.getConnection("mock:my-mock-connection")) {
    conn
        .readRequestBuilder
        .addItem("station", "MyAdress")
        .build()
        .execute()
        .get();
} catch (Exception e) {
    // do nothing
}

// Check that the we really issued a Read request to the Field "MyAdress"
verify(mockDevice).read(eq("MyAdress"));</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>The Snippet above shows that the part under test really has to share nothing with the test code except for the connection string.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_conclusion1">Conclusion</h3> 
   <div class="paragraph"> 
    <p>The above examples show that the <code>MockDriver</code> driver can not only be used to play around with the API but is also a powerful tool to do unit testing of Code which uses the PLC4X API. All that needs to be done is to either pass an instance of the Mocked Connection or just use the same Connection string (e.g. from a test configuration) that was used to Prepare a Mock Device. Some Examples of futher (more Complex) use cases can be found in the PLC4X Codebases, e.g. in the following classes</p> 
   </div> 
   <div class="ulist"> 
    <ul> 
     <li> <p><code>org.apache.plc4x.java.opm.PlcEntityManagerTest</code></p> </li> 
     <li> <p><code>org.apache.plc4x.java.opm.PlcEntityManagerComplexTest</code></p> </li> 
     <li> <p><code>org.apache.plc4x.java.scraper.ScraperTest</code></p> </li> 
    </ul> 
   </div> 
   <div class="paragraph"> 
    <p>and many more Test classes, especially in the OPM and the Scraper Module.</p> 
   </div> 
  </div> 
 </div> 
</div>      </div>
    </div>
  </div> <!-- /row -->
  </div>
    </div> <!-- end : row -->
</div> <!-- /container -->
  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Reports</li>
                    <li ><a  href="../project-info.html"  title="Project Information" >Project Information <i class="glyphicon glyphicon-chevron-right"></i></a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Apache</li>
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Protocols</li>
                    <li ><a  href="../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../protocols/ab-eth/index.html"  title="AB-Ethernet" >AB-Ethernet</a></li>
                    <li ><a  href="../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../protocols/s7/index.html"  title="S7" >S7</a></li>
                </ul>

            </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="pull-right"><a id="m-scroll-top" href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2017-2020                 <a href="https://www.apache.org/">The Apache Software Foundation</a>
. All Rights Reserved.</p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>

      </div>
    </div>
  </div>
  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>

  <script src="../js/lightbox.min.js"></script>

  <script src="../js/reflow-scroll.js"></script>
	<script src="../js/highlight.min.js"></script>
  <script src="../js/reflow-skin.js"></script>
    <script src="../js/anchor.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function(event) {
            anchors.options = {
              placement: 'left',
            };
            anchors.add('h1,h2, h3, h4, h5, h6');
        });
    </script>

  </body>
</html>